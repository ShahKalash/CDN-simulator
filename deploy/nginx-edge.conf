worker_processes  1;

events { worker_connections 1024; }

http {
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=EDGE:100m inactive=10m max_size=5g;
    proxy_cache_valid 200 302 10m;
    proxy_cache_valid 404 1m;
    proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
    proxy_cache_lock on;

    include       mime.types;
    default_type  application/octet-stream;

    server {
        listen 8081;
        server_name edge;

        location / {
            proxy_set_header Host $host;
            proxy_http_version 1.1;
            proxy_buffering on;
            proxy_cache EDGE;
            proxy_cache_key "$scheme://$host$request_uri";
            add_header X-Cache-Status $upstream_cache_status;
            add_header 'Access-Control-Allow-Origin' '*' always;
            add_header 'Access-Control-Allow-Methods' 'GET, HEAD, OPTIONS' always;
            add_header 'Access-Control-Allow-Headers' '*' always;
            if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Max-Age' 86400;
                return 204;
            }
            proxy_pass http://origin:8080;

            # Range requests support
            proxy_set_header Range $http_range;
            proxy_set_header If-Range $http_if_range;
        }
    }
}


